<toolkit:Popup xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
               xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
               xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
               xmlns:local="clr-namespace:NavascaBasTaskerApp.MVVM.Views"
               x:Class="NavascaBasTaskerApp.MVVM.Views.TaskDetailPopup"
               Color="Transparent">
    
    <Border BackgroundColor="White" 
            StrokeShape="RoundRectangle 20" 
            Padding="0" 
            WidthRequest="340"
            MaximumHeightRequest="300"
            Stroke="Transparent">

        <Border.Shadow>
            <Shadow Brush="Black" Offset="0,1" Radius="20" Opacity="0.3"/>
        </Border.Shadow>
        
        
        <Grid RowDefinitions="*, Auto">

            <ScrollView VerticalScrollBarVisibility="Always" Padding="25">
                <VerticalStackLayout>

                    <Label Text="{Binding DisplayCategoryName, Source={RelativeSource AncestorType={x:Type local:TaskDetailPopup}}}" 
                           TextColor="{Binding TaskColor}"
                           Style="{StaticResource DisplayCategoryNameLabelStyle}" />

                    <Label Text="Task Name" 
                           Style="{StaticResource FieldHeaderLabelStyle}" 
                           Margin="0,0,0,5" />

                    <Label Text="{Binding TaskName}" 
                           Style="{StaticResource TaskNameDisplayStyle}"
                           IsVisible="{Binding IsEditMode, Source={RelativeSource AncestorType={x:Type local:TaskDetailPopup}}, Converter={toolkit:InvertedBoolConverter}}" />

                    <Entry Text="{Binding TaskName}" 
                           Style="{StaticResource TaskNameEntryStyle}"
                           IsVisible="{Binding IsEditMode, Source={RelativeSource AncestorType={x:Type local:TaskDetailPopup}}}" />

                    <Label Text="Description" 
                           Style="{StaticResource FieldHeaderLabelStyle}" 
                           Margin="0,20,0,10" />

                    <Label Text="{Binding Description}" 
                           Style="{StaticResource DescriptionDisplayStyle}"
                           IsVisible="{Binding IsEditMode, Source={RelativeSource AncestorType={x:Type local:TaskDetailPopup}}, Converter={toolkit:InvertedBoolConverter}}" />

                    <Editor Text="{Binding Description}" 
                            Style="{StaticResource DescriptionEditorStyle}"
                            IsVisible="{Binding IsEditMode, Source={RelativeSource AncestorType={x:Type local:TaskDetailPopup}}}" />

                </VerticalStackLayout>
            </ScrollView>

            <Border Grid.Row="1" BackgroundColor="White" WidthRequest="320" HeightRequest="90" Stroke="Transparent">

                <Border.Shadow>
                    <Shadow Brush="White" Offset="0,-5" Radius="5" Opacity="0.6"/>
                </Border.Shadow>

                <HorizontalStackLayout Spacing="10" HorizontalOptions="Center" Padding="20">
                    <Button x:Name="EditSaveBtn"
                            Style="{StaticResource EditSaveBtnStyle}"
                            Clicked="OnEditSaveClicked" />

                    <Button Style="{StaticResource DeleteBtnStyle}"
                            Clicked="OnDeleteClicked"
                            IsVisible="{Binding IsEditMode, Source={RelativeSource AncestorType={x:Type local:TaskDetailPopup}}, Converter={toolkit:InvertedBoolConverter}}" />

                    <Button Style="{StaticResource CancelBtnStyle}"
                            Clicked="OnCancelClicked"
                            IsVisible="{Binding IsEditMode, Source={RelativeSource AncestorType={x:Type local:TaskDetailPopup}}}" />
                </HorizontalStackLayout>

            </Border>

        </Grid>
    </Border>
</toolkit:Popup>